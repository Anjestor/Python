# [6.3. Модуль requests](https://education.yandex.ru/handbook/python/article/modul-requests)
## A. Проверка системы
В локальной сети тестирующей системы работает сервер 127.0.0.1. Он слушает порт 5000 и иногда отвечает на него.  

Обратитесь к серверу и выведите сообщение, полученное от него.  

**Примечания**  
- Во всех задачах данной главы используется протокол http  
- Не забудьте, что ответ сервера является бинарным объектом и его следует декодировать.  

### Пример 1  
**Ввод**  
```
# Пользовательский ввод:

# Данные сервера:
Привет!
```

**Вывод**  
```
Привет!
```

### Пример 2  
**Ввод**  
```
# Пользовательский ввод:

# Данные сервера:
Сервер работает в штатном режиме
```

**Вывод**  
```
Сервер работает в штатном режиме
```

---
```python
from requests import get

print(get('http://127.0.0.1:5000').text)
```

## B. Суммирование ответов
Напишите программу, которая суммирует данные, передаваемые с сервера.  

Если сервер передал число 0, значит, данные закончились и он перезапустит выдачу ответов.  

**Формат ввода**  
Вводится адрес сервера.  

**Формат вывода**  
Одно число — сумма всех данных, полученных с сервера.  

### Пример 1
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
# Данные сервера:
1
2
3
0
```

**Вывод**  
```
6
```

### Пример 2
**Ввод**
```
# Пользовательский ввод:
127.0.0.1:8080
# Данные сервера:
7
3
-5
2
0
```

**Вывод**  
```
7
```

---
```python
from requests import get

s = 0
url = 'http://' + input()

while (res := int(get(url).text)) != 0:
    s += res

print(s)
```

## C. Суммирование ответов 2
Сервер отвечает на запрос JSON списком.  
Выведите сумму чисел в полученном списке.  

**Формат ввода**  
Вводится адрес сервера  

**Формат вывода**  
Одно число — сумма всех чисел в полученном списке.  

### Пример 1
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
# Данные сервера:
[1, 2, "ошибка", 3]
```

**Вывод**  
```
6
```

### Пример 2
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:8080
# Данные сервера:
[7, 3, ["ошибка"], -5, 2]
```

**Вывод**  
```
7
```

---
```python
from requests import get

url = 'http://' + input()
req = get(url).json()
s = 0

for i in req:
    if isinstance(i, int):
        s += i

print(s)
```

## D. Конкретное значение
Сервер отвечает на запрос JSON объект.  
Выведите значение, находящееся в объекте по заданному ключу.  
Если такое значение не обнаружено, то выведите сообщение «No data».  

**Формат ввода**  
В первой строке вводится адрес сервера. Во второй строке — имя ключа.  

**Формат вывода**  
Одна строка — значение, полученное по заданному ключу, или сообщение «No data».  

### Пример 1
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
second
# Данные сервера:
{"first": "1", "second": "2"}
```

**Вывод**  
```
2
```

### Пример 2
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:8080
second
# Данные сервера:
{"first": "1", "third": "3"}
```

**Вывод**  
```
No data
```

---
```python
from requests import get

url = 'http://' + input()
req = get(url).json()
key = str(input())

print(req.get(key, "No data"))
```

## E. Суммирование ответов 3
Сервер отвечает на несколько путей, каждый из которых возвращает свой JSON список. Напишите программу, которая произведёт сбор и суммирование всех данных по заданным путям.  

**Формат ввода**  
Вводится адрес сервера и список анализируемых путей.  

**Формат вывода**  
Одно число — сумма всех чисел из полученных списков.  

### Пример 1
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
/first
/third
# Данные сервера:
/first -> [1, 2, 3]
/second -> [2, 4, 6]
/third -> [3, 6, 9]
```

**Вывод**  
```
24
```

### Пример 2
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:8080
/second
# Данные сервера:
/first -> [1, 2, 3]
/second -> [2, 4, 6]
/third -> [3, 6, 9]
```

**Вывод**  
```
12
```

---
```python
from requests import get
from sys import stdin

url = 'http://' + input()
paths = [i.rstrip('\n') for i in stdin]
s = 0

for p in paths:
    s += sum(get(url + p).json())

print(s)
```

## F. Список пользователей
На сервере по пути /users, доступен список пользователей, представленных JSON объектами с ключами:  

- id — уникальный идентификатор пользователя;  
- username — имя пользователя;  
- last_name — фамилия;  
- first_name — имя;  
- email — адрес электронной почты.  

**Формат ввода**  
В первой строке вводится адрес сервера.  

**Формат вывода**  
Выведите список всех пользователей системы в алфавитном порядке.  

### Пример
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

**Вывод**  
```
Иванов Василий
Иванов Виктор
Петрова Елизавета
```

---
```python
from requests import get
from sys import stdin

url = 'http://' + input() + '/users'
usrs = get(url).json()
names = []

for i in usrs:
    names.append(' '.join([i["last_name"], i["first_name"]]))

for i in sorted(names, key=lambda i: i):
    print(i)
```

## G. Рассылка сообщений
Продолжим работу с сервером из прошлой задачи. По пути /users/<id> доступен JSON объект пользователя с заданным id.  

Подготовьте текст письма для отправки важной рассылки.  

Если пользователь с заданным идентификатором не найден, выведите сообщение «Пользователь не найден».  

**Формат ввода**  
В первой строке вводится адрес сервера.  
Во второй строке вводится id пользователя, которому требуется отправить письмо.  
В последующих строках записано содержание сообщения с форматированными вставками любого из полей объекта.  

**Формат вывода**  
Выведите подготовленное сообщение.  

### Пример 1
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
2
Письмо для: {email}
Здравствуйте, {last_name} {first_name}
Мы рады сообщить вам о предстоящей акции!
Все подробности на нашем сайте
С уважением, команда тестового сервера!
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

**Вывод**  
```
Письмо для: vas.ivanov@server.none
Здравствуйте, Иванов Василий
Мы рады сообщить вам о предстоящей акции!
Все подробности на нашем сайте
С уважением, команда тестового сервера!
```

### Пример 2
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
2
Письмо для: {email}
Здравствуйте, {last_name} {first_name} ({username})
Мы рады сообщить вам о предстоящей акции!
Все подробности на нашем сайте
С уважением, команда тестового сервера!
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    }
]
```

**Вывод**  
```
Пользователь не найден
```

---
```python
from requests import get
from sys import stdin

url = 'http://' + input() + '/users/' + input()
mess = ''.join(i for i in stdin)

try:
    user_data = get(url).json()
    for i in user_data:
        mess = mess.replace('{' + i + '}', str(user_data[i]))
    print(mess)
except ValueError:
    print('Пользователь не найден')
```

## H. Регистрация нового пользователя
Продолжим работу с сервером из прошлых задач. При POST запросе по пути /users доступна возможность создания новых пользователей. Для этого в данные запроса (data) требуется передать JSON объект с информацией о пользователе (без указания идентификатора).  

Напишите программу, которая добавляет нового пользователя в систему.  

**Формат ввода**  
В первой строке вводится адрес сервера.  
В следующих строках вводятся: имя пользователя, фамилия, имя и адрес электронной почты.  

**Формат вывода**  
Ничего выводить не требуется.  

### Пример
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
fourth
Петров
Кирилл
k.petrov@server.none
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

**Вывод**  
```
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    },
    {
        "username": "fourth",
        "last_name": "Петров",
        "first_name": "Кирилл",
        "email": "k.petrov@server.none",
        "id": 4
    }
]
```

---
```python
from requests import post

url = 'http://' + input() + '/users'
new_user = {"username": input(),
            "last_name": input(),
            "first_name": input(),
            "email": input()}

post(url, json=new_user)
```

## I. Изменение данных
Продолжим работу с сервером из прошлых задач. При PUT запросе по пути /users/<id> доступна возможность изменение информации о пользователе. Для этого в данные запроса (data) требуется передать JSON объект с новой информацией (без указания идентификатора).  

Напишите программу, которая изменяет информацию о пользователе.  

**Формат ввода**  
В первой строке вводится адрес сервера.  
Во второй строке записан идентификатор пользователя, информацию о котором требуется изменить. В следующих строках вводятся данные для изменения в формате: <название поля>=<новое значение>.  

**Формат вывода**  
Ничего выводить не требуется.  

### Пример
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
2
username=ivanov_vasily
email=ivanov_vasily@server.none
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

**Вывод**  
```
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "ivanov_vasily",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "ivanov_vasily@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

---
```python
from requests import put
from json import dumps
from sys import stdin

url = 'http://' + input() + '/users/' + input()
update_user = {k: v for k, v in (i.rstrip('\n').split('=') for i in stdin)}

put(url, data=dumps(update_user))
```

## J. Удаление данных
Завершим эпопею с сервером из прошлых задач. При DELETE запросе по пути /users/<id> производится удаление пользователя с заданным идентификатором.  

Напишите программу, которая удаляет пользователя из системы.  

**Формат ввода**  
В первой строке вводится адрес сервера.  
Во второй строке записан идентификатор пользователя, информацию о котором требуется удалить.  

**Формат вывода**  
Ничего выводить не требуется.  

### Пример
**Ввод**  
```
# Пользовательский ввод:
127.0.0.1:5000
2
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 2,
        "username": "second",
        "last_name": "Иванов",
        "first_name": "Василий",
        "email": "vas.ivanov@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

**Вывод**  
```
# Данные сервера:
[
    {
        "id": 1,
        "username": "first",
        "last_name": "Петрова",
        "first_name": "Елизавета",
        "email": "e.petrova@server.none"
    },
    {
        "id": 3,
        "username": "third",
        "last_name": "Иванов",
        "first_name": "Виктор",
        "email": "vik.ivanov@server.none"
    }
]
```

---
```python
from requests import delete

url = 'http://' + input() + '/users/' + input()

delete(url)
```
